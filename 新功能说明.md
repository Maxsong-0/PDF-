# 🎉 PDF重命名工具 - 新功能说明

## ✨ 最新功能特性

### 🔄 **直接重命名模式**
- **不再需要下载**：识别成功后直接重命名原文件
- **即时生效**：上传即重命名，无需额外操作
- **智能去重**：自动处理同名文件冲突

### 📂 **自动备份系统**
- **按日期分类**：每天的备份保存在独立文件夹中
- **格式**：`backup/YYYY-MM-DD/原文件名.pdf`
- **时间戳**：同名文件自动添加时间戳防冲突
- **完整保护**：重命名前自动创建原文件备份

### 🔍 **增强识别功能**
- **专用格式支持**：完美识别 `****-************` 格式
- **示例格式**：`1403-202501030009`、`1409-202501080007`
- **智能角度检测**：三种方法综合判断文档旋转角度
- **高准确率**：测试显示100%识别成功率

### 🌐 **自适应端口**
- **智能检测**：自动找到可用端口启动服务
- **端口范围**：8000-8009（主要），9000-9004（备用）
- **友好提示**：启动时显示具体访问地址

## 🚀 使用方法

### 1. 启动服务
```bash
python main.py
```
服务会自动选择可用端口并显示访问地址：
```
🌐 服务将在以下地址启动:
   - 本地访问: http://localhost:8000
   - 网络访问: http://0.0.0.0:8000
```

### 2. 上传文件
- 访问 Web 界面
- 上传包含销货出库单号的 PDF 文件
- 等待处理完成

### 3. 查看结果
处理完成后会显示：
- ✅ 重命名成功的文件
- 📂 备份文件路径
- 📋 详细处理日志

## 📊 功能对比

| 功能 | 旧版本 | 新版本 |
|------|-------|--------|
| 文件处理 | 复制到downloads文件夹 | **直接重命名原文件** |
| 备份机制 | 无 | **按日期自动备份** |
| 端口冲突 | 启动失败 | **自动选择可用端口** |
| 识别格式 | 基础支持 | **专用4-12格式优化** |
| 角度检测 | 单一方法 | **三种方法综合判断** |

## 🔧 API 接口

### 上传处理 `POST /upload`
```json
{
    "results": [
        {
            "filename": "原文件名.pdf",
            "success": true,
            "message": "✅ 文件重命名成功: 原文件名.pdf → 1403-202501030009.pdf",
            "new_filename": "1403-202501030009.pdf",
            "backup_path": "backup/2025-06-10/原文件名.pdf",
            "order_number": "1403-202501030009",
            "log": "详细处理日志..."
        }
    ],
    "processed_count": 1,
    "total_count": 1,
    "backup_info": "备份保存在: backup/2025-06-10/"
}
```

### 备份信息 `GET /backup-info`
```json
{
    "backup_folders": [
        {
            "date": "2025-06-10",
            "file_count": 2,
            "files": ["文件1.pdf", "文件2.pdf"]
        }
    ],
    "total_backups": 2,
    "message": "共有 1 天的备份，总计 2 个文件"
}
```

### 清理功能
- `POST /clear` - 清理uploads文件夹
- `POST /clear-backup?date=2025-06-10` - 清理指定日期备份
- `POST /clear-backup` - 清理所有备份

## 📁 文件夹结构

```
项目根目录/
├── main.py              # 主程序
├── uploads/             # 处理后的文件（重命名后）
├── backup/              # 备份文件夹
│   ├── 2025-06-10/     # 按日期分类的备份
│   │   ├── 原文件1.pdf
│   │   └── 原文件2.pdf
│   └── 2025-06-11/
└── test/               # 测试文件夹
```

## 🎯 订单号格式支持

### 标准格式
- `1403-202501030009` ✅
- `1409-202501080007` ✅
- `ABCD-123456789012` ✅

### 兼容格式
- 中文：`销货出库单号：1403-202501030009`
- 英文：`Order Number: 1403-202501030009`
- 简化：`SO: 1403-202501030009`

## ⚠️ 注意事项

1. **备份重要性**：重命名前会自动备份，但请定期清理备份文件夹
2. **文件权限**：确保程序对uploads和backup文件夹有读写权限
3. **存储空间**：备份会占用额外存储空间，请注意磁盘使用情况
4. **网络访问**：如需局域网访问，使用 http://你的IP地址:端口号

## 🐛 故障排除

### 常见问题
1. **端口被占用**：程序会自动切换到其他端口
2. **识别失败**：检查PDF是否包含清晰的订单号文字
3. **备份失败**：检查backup文件夹权限
4. **重命名失败**：检查uploads文件夹权限

### 日志查看
程序运行时会显示详细日志，包括：
- 角度检测详情
- OCR识别过程
- 备份创建状态
- 重命名结果

---

**🎉 新版本让PDF重命名更加智能、安全、高效！** 